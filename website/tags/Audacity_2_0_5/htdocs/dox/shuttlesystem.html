<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Audacity: The Shuttle System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="ShuttleSystem">The <a class="el" href="class_shuttle.html" title="Moves data from one place to another, converting it as required.">Shuttle</a> System </a></h1><h2><a class="anchor" id="ShuttleIntro">
Introduction</a></h2>
<p>The classes <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a>, <a class="el" href="class_shuttle_cli.html" title="Derived from Shuttle, this class exchanges string parameters with a binary representation...">ShuttleCli</a>, <a class="el" href="class_shuttle_gui_base.html" title="Base class for shuttling data to and from a GUI.">ShuttleGuiBase</a> and <a class="el" href="class_shuttle.html" title="Moves data from one place to another, converting it as required.">Shuttle</a> were designed to simplify repetitive code that moves data around. Common repetitive tasks in Audacity are creating dialogs, moving data in and out of dialogs and converting from binary to text formats.</p>
<h2><a class="anchor" id="ShuttleSplit">
ShuttleGui Vs ShuttleGuiBase</a></h2>
<p><a class="el" href="class_shuttle_gui_base.html" title="Base class for shuttling data to and from a GUI.">ShuttleGuiBase</a> is slated for <a class="el" href="widgetmigration.html">WidgetMigration</a> . It contains functions that work with widgets that are in wxWidgets. The derived class, <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a>, contains extensions that are specific to Audacity widgets. It isn't slated for widget migration.</p>
<h2><a class="anchor" id="ShuttleGuiInit">
Initialising ShuttleGui</a></h2>
<p>A common idiom in using the <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> is as follows - this example comes from AudioIOPrefs::Populate() :</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// Code is from a dialog class, so &apos;this&apos; is a pointer to the dialog</span>
   <a class="code" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> S(<span class="keyword">this</span>, <a class="code" href="_shuttle_gui_8h.html#a0c8bf96cca5e5b020b22818e8490b964a292c1dc8dd6a62ebd71226a4f05e63fb">eIsCreatingFromPrefs</a>); <span class="comment">// Create the shuttle.</span>
   PopulateOrExchange(S); <span class="comment">// Use it.</span>
</pre></div><p><code>S</code> is a temporary object, only kept for as long as needed to actually do the one exchange.</p>
<p>The first line creates and initialises the <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> object, setting it up for creating a dialog's contents using information about initial values from the global preferences.</p>
<p>The <code>PopulateOrExchange()</code> function is here being used to populate the dialog. The same function can be called from elsewhere, later, with a different <code>S</code> to exchange data.</p>
<p>The instance of <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a>, <code>S</code>, shown in the example above isn't needed after returning from <code>PopulateOrExchange()</code>.</p>
<h2><a class="anchor" id="ShuttleGuiMethods">
ShuttleGui Methods</a></h2>
<p><a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> has several kinds of methods.</p>
<ul>
<li>Layout methods like <a class="el" href="class_shuttle_gui_base.html#aa456756283f789e26c6841eb3ca55c72">ShuttleGui::StartHorizontalLay()</a>, used to start a piece of GUI that is to be laid out horizontally. Use <a class="el" href="class_shuttle_gui_base.html#a80917a37e36156f398a24436c1f3dba9">ShuttleGui::EndHorizontalLay()</a> to end such a section. This is a simple wrapper for the wxWidgets wxBoxSizer. It has the advantage that the <a class="el" href="class_shuttle.html" title="Moves data from one place to another, converting it as required.">Shuttle</a> keeps track of the sizer. You do not need to. You do not need to provide a name for the sizer. This shortens the code.</li>
</ul>
<div class="fragment"><pre class="fragment">   <span class="comment">// Example of using a Start/End pair</span>
   S.StartHorizontalLay()
   {
   ... Add controls that you want in the horizontal layout
   }
   S.EndHorizontalLay()
</pre></div><p>The <code>{</code> <code>}</code> braces are optional, just add them where they improve readability.</p>
<ul>
<li><code>Add</code> methods, like <a class="el" href="class_shuttle_gui_base.html#a8c68a737f8ab224fefa8b4f452c38073">ShuttleGui::AddCheckBox()</a>. This adds the check box and returns a pointer to it. You use <code>Add</code> methods when you don't want <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> to handle the data exchange. It just creates the control and adds it into the current sizer.</li>
</ul>
<div class="fragment"><pre class="fragment">  <span class="comment">// Example of calling an Add method</span>
      S.AddChoice( _(<span class="stringliteral">&quot;Script:&quot;</span>),_(<span class="stringliteral">&quot;(a) Basic Operation&quot;</span>), &amp;mScripts );
</pre></div><ul>
<li><code>Tie</code> methods, like <a class="el" href="class_shuttle_gui_base.html#a6936617e42a318feca1856916f2f5a6f">ShuttleGui::TieCheckBox()</a>. This creates the check box as above, returning a pointer to it. It also facilitates exchange of data with the control.</li>
</ul>
<div class="fragment"><pre class="fragment">  <span class="comment">// Example of calling a Tie method</span>
      S.TieChoice( _(<span class="stringliteral">&quot;Device:&quot;</span>), mDevice,
         wxT(<span class="stringliteral">&quot;&quot;</span>), mmPlayNames, mmPlayLabels );
</pre></div><p>So <code>Tie</code> methods and <code>Add</code> methods are very similar. The <code>Tie</code> methods have more parameters to them. You have to specify what you are exchanging with. There are many name overloaded variants on <code>Tie</code> methods to suit different circumstances. Exchanging an integer with a text box uses a different overload to exchanging a string with the text box.</p>
<p>In the example above, <code>mDevice</code> is a <code>wxString</code> variable passed by reference to the function. This allows <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> both to read and write to it. Which happens depends on how <code>S</code> has been configured.</p>
<p>With both <code>Add</code> and <code>Tie</code> you can optionally specify a windows Id. Use code like the following:</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// Example of using a windows Id that we chose.  </span>
   S.Id( idSplashScreen ).TieCheckBox( _(<span class="stringliteral">&quot;Show Splash Screen&quot;</span>),
      wxT(<span class="stringliteral">&quot;\Inits\Splash&quot;</span>), <span class="keyword">true</span> );
</pre></div><p>Where you don't specify an Id, <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> will assign the Id's sequentially.</p>
<h2><a class="anchor" id="ShuttleGuiLayoutTips">
ShuttleGui Layout Tips</a></h2>
<p><a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> wraps wxWidget sizers, and the wxWidgets sizer system can sometimes itself be confusing. The most common problem is finding that controls don't resize at all for some reason.</p>
<p>Resizing requires that 'stretchiness' propogate all the way down from the ultimate parent window. Any sizers that is not using <code>wxEXPAND</code> will cause everything within in it to retain the size it had when the GUI was created, i.e. it will not resize when the window does. A very common idiom is to use <code>wxEXPAND</code> but with an expand proportion of '0'. That still allows expansion but <b>not</b> in the main direction. By contrast using <code>wxALIGN_LEFT</code> prevents expansion in either direction.</p>
<p>Many of the <code>Add</code> and <code>Tie</code> functions are designed with a two column layout in mind. So use an idiom like this:</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// The &apos;1&apos; in the next line indicates a resizable wxStaticBox.</span>
   S.StartStatic( _(<span class="stringliteral">&quot;Recording&quot;</span>), 1 );
   {
      S.StartTwoColumn();
      S.TieChoice( _(<span class="stringliteral">&quot;Device:&quot;</span>), wxT(<span class="stringliteral">&quot;RecordingDevice&quot;</span>), 
         wxT(<span class="stringliteral">&quot;&quot;</span>), mmPlayNames, mmPlayLabels );
      S.TieChoice( _(<span class="stringliteral">&quot;Channels:&quot;</span>), wxT(<span class="stringliteral">&quot;RecordChannels&quot;</span>), 
         wxT(<span class="stringliteral">&quot;2&quot;</span>), mmChannelNames, mmChannelLabels );
      S.EndTwoColumn();
   }
</pre></div><p>The prompts <code>'Device</code>:' and <code>'Channels</code>:' will land in the first column and the actual choice controls will land in the second column. All of this is inside a <code>wxStaticBox</code> with the name <code>'Recording'</code> on it.</p>
<p>To make the choice controls stretch when the <code>wxStaticBox</code> grows or shrinks, adjust the code to read:</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// This idiom may be simplified when new functions are added to ShuttleGui</span>
   S.StartStatic( _(<span class="stringliteral">&quot;Recording&quot;</span>), 1 );
   {
      S.StartMultiColumn(2, wxEXPAND);
      S.SetStretchyCol(1);
      S.TieChoice( _(<span class="stringliteral">&quot;Device:&quot;</span>), wxT(<span class="stringliteral">&quot;RecordingDevice&quot;</span>), 
         wxT(<span class="stringliteral">&quot;&quot;</span>), mmPlayNames, mmPlayLabels );
      S.TieChoice( _(<span class="stringliteral">&quot;Channels:&quot;</span>), wxT(<span class="stringliteral">&quot;RecordChannels&quot;</span>), 
         wxT(<span class="stringliteral">&quot;2&quot;</span>), mmChannelNames, mmChannelLabels );
      S.EndMultiColumn();
   }
</pre></div><h2><a class="anchor" id="ShuttleGuiInternals">
ShuttleGui Internals</a></h2>
<p><a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> cleans up the classes which use it. Parts of its own internal code are quite repetitive, doing the same thing for different widgets with slightly different options - e.g. a wxTextCtrl with an integer value or with a string. To make the internals of <a class="el" href="class_shuttle_gui.html" title="Derived from ShuttleGuiBase, an Audacity specific class for shuttling data to and...">ShuttleGui</a> cleaner, it uses class <a class="el" href="class_wrapped_type.html" title="Used in type conversions, this wrapper for ints, strings, doubles and enums provides...">WrappedType</a>. Also compound functions are formed by chaining together shorter functions. This makes it much easier to add new options. </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Sat Mar 6 23:01:10 2010 for Audacity by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
